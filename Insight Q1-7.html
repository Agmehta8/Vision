<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insight – Patient Needs Assessment</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="assessment-body">
  <main class="container assessment-container">
    <header class="assessment-header">
      <div>
        <p class="eyebrow">Welcome back</p>
        <h1 class="assessment-title">Patient Needs Assessment</h1>
        <p class="assessment-subtitle">Move through each question at your own pace. You can return at any time.</p>
      </div>
      <div class="progress-ring" aria-label="Assessment progress">
        <svg viewBox="0 0 120 120" role="img">
          <circle class="progress-ring__track" cx="60" cy="60" r="52"></circle>
          <circle class="progress-ring__value" cx="60" cy="60" r="52"></circle>
        </svg>
        <div class="progress-ring__text">
          <span id="progress-count">0</span>
          <span class="progress-ring__label">of 6 completed</span>
        </div>
      </div>
    </header>

    <section class="question-list" id="questionList" aria-label="Assessment questions"></section>
  </main>

  <section class="focus-overlay" id="focusOverlay" aria-hidden="true">
    <div class="focus-panel">
      <button class="focus-home" id="focusHome" aria-label="Return to dashboard">
        <span aria-hidden="true">←</span> Home
      </button>
      <div class="focus-content">
        <p class="focus-category" id="focusCategory"></p>
        <h2 class="focus-question" id="focusQuestion"></h2>
        <div class="option-group" id="focusOptions"></div>
      </div>
      <div class="focus-footer">
        <button class="secondary-button" id="skipQuestion" type="button">Skip for now</button>
        <div class="focus-nav">
          <button class="ghost-button" id="prevQuestion" type="button">Previous</button>
          <button class="primary-button" id="nextQuestion" type="button">Next</button>
        </div>
      </div>
    </div>
  </section>

  <script>
    const questions = [
      {
        id: "q1",
        category: "Status",
        question: "What stage is your cancer?",
        options: [
          "No evidence of cancer",
          "Early stage of cancer",
          "Middle stage of cancer",
          "Late stage of cancer",
          "End stage of cancer",
          "Do not know",
        ],
      },
      {
        id: "q2",
        category: "Provider Perspective",
        question:
          "Which of the following best represents what your oncology providers have told you about a cure for your cancer?",
        options: [
          "<strong>My cancer will be cured</strong>",
          "<strong>My cancer may be cured</strong> if treatments are successful",
          "<strong>My cancer cannot be cured</strong> but we will try to control the cancer with treatment",
          "<strong>My cancer cannot be cured</strong> and I am not able to have any additional cancer treatment",
          "Do not know",
        ],
      },
      {
        id: "q3",
        category: "Patient Perspective",
        question: "Which of the following best represents what you think about a cure for your cancer?",
        options: [
          "<strong>My cancer will be cured</strong>",
          "<strong>My cancer may be cured</strong> if treatments are successful",
          "<strong>My cancer cannot be cured</strong> but we will try to control the cancer with treatment",
          "<strong>My cancer cannot be cured</strong> and I am not able to have any additional cancer treatment",
          "Do not know",
        ],
      },
      {
        id: "q4",
        category: "Prognosis Info",
        question:
          "What have your oncology providers told you about how long you are expected to live (your prognosis)?",
        ui_type: "timeline",
        options: ["Weeks", "Months", "Years", "Decades"],
        secondary_options: [
          "We have discussed this, but I have not received a clear answer",
          "We have not discussed this",
        ],
      },
      {
        id: "q5",
        category: "Patient Prognosis",
        question: "At this moment, how long do you think you will live?",
        ui_type: "timeline",
        options: ["Weeks", "Months", "Years", "Decades"],
        secondary_options: ["I do not know", "I do not want to think about this"],
      },
      {
        id: "q6",
        category: "Health Status",
        question: "How would you describe your current health status?",
        options: [
          "Relatively healthy",
          "Relatively healthy and terminally ill",
          "Seriously ill but not terminally ill",
          "Seriously ill and terminally ill",
          "Do not know",
        ],
      },
    ];

    const state = {
      answers: {},
      skipped: new Set(),
      currentIndex: 0,
    };

    const questionList = document.getElementById("questionList");
    const focusOverlay = document.getElementById("focusOverlay");
    const focusCategory = document.getElementById("focusCategory");
    const focusQuestion = document.getElementById("focusQuestion");
    const focusOptions = document.getElementById("focusOptions");
    const progressCount = document.getElementById("progress-count");
    const progressRing = document.querySelector(".progress-ring__value");

    const focusHome = document.getElementById("focusHome");
    const prevQuestion = document.getElementById("prevQuestion");
    const nextQuestion = document.getElementById("nextQuestion");
    const skipQuestion = document.getElementById("skipQuestion");

    const ringRadius = 52;
    const ringCircumference = 2 * Math.PI * ringRadius;
    progressRing.style.strokeDasharray = `${ringCircumference} ${ringCircumference}`;

    const updateProgressRing = () => {
      const completedCount = Object.keys(state.answers).length;
      const total = questions.length;
      const progress = completedCount / total;
      const offset = ringCircumference - progress * ringCircumference;
      progressRing.style.strokeDashoffset = offset;
      progressCount.textContent = completedCount;
      document.querySelector(".progress-ring__label").textContent = `of ${total} completed`;
    };

    const getStatus = (questionId) => {
      if (state.answers[questionId]) return "completed";
      if (state.skipped.has(questionId)) return "skipped";
      return "unanswered";
    };

    const renderDashboard = () => {
      questionList.innerHTML = "";
      questions.forEach((question, index) => {
        const status = getStatus(question.id);
        const card = document.createElement("button");
        card.type = "button";
        card.className = `question-card ${status}`;
        card.addEventListener("click", () => openFocus(index));

        card.innerHTML = `
          <div class="card-status">
            <span class="status-icon" aria-hidden="true"></span>
          </div>
          <div class="card-content">
            <p class="card-category">${question.category}</p>
            <h3 class="card-question">${question.question}</h3>
            <p class="card-meta">${status === "completed" ? "Completed" : status === "skipped" ? "Skipped" : "Not answered"}</p>
          </div>
        `;

        questionList.appendChild(card);
      });
    };

    const renderOptions = (question) => {
      focusOptions.innerHTML = "";

      const primaryOptions = document.createElement("div");
      primaryOptions.className = `option-tiles ${question.ui_type === "timeline" ? "option-tiles--row" : ""}`;

      question.options.forEach((option) => {
        const button = document.createElement("button");
        button.type = "button";
        button.className = "option-tile";
        button.innerHTML = option;
        if (state.answers[question.id] === option) {
          button.classList.add("selected");
        }
        button.addEventListener("click", () => selectOption(question.id, option));
        primaryOptions.appendChild(button);
      });

      focusOptions.appendChild(primaryOptions);

      if (question.secondary_options) {
        const secondaryWrapper = document.createElement("div");
        secondaryWrapper.className = "secondary-options";
        question.secondary_options.forEach((option) => {
          const button = document.createElement("button");
          button.type = "button";
          button.className = "option-tile option-tile--secondary";
          button.textContent = option;
          if (state.answers[question.id] === option) {
            button.classList.add("selected");
          }
          button.addEventListener("click", () => selectOption(question.id, option));
          secondaryWrapper.appendChild(button);
        });
        focusOptions.appendChild(secondaryWrapper);
      }
    };

    const openFocus = (index) => {
      state.currentIndex = index;
      const question = questions[index];
      focusCategory.textContent = question.category;
      focusQuestion.textContent = question.question;
      renderOptions(question);
      focusOverlay.classList.add("open");
      focusOverlay.setAttribute("aria-hidden", "false");
    };

    const closeFocus = () => {
      focusOverlay.classList.remove("open");
      focusOverlay.setAttribute("aria-hidden", "true");
    };

    const selectOption = (questionId, option) => {
      state.answers[questionId] = option;
      state.skipped.delete(questionId);
      renderDashboard();
      renderOptions(questions[state.currentIndex]);
      updateProgressRing();
    };

    const navigateQuestion = (direction) => {
      const newIndex = state.currentIndex + direction;
      if (newIndex < 0 || newIndex >= questions.length) return;
      openFocus(newIndex);
    };

    focusHome.addEventListener("click", closeFocus);
    prevQuestion.addEventListener("click", () => navigateQuestion(-1));
    nextQuestion.addEventListener("click", () => navigateQuestion(1));
    skipQuestion.addEventListener("click", () => {
      const question = questions[state.currentIndex];
      delete state.answers[question.id];
      state.skipped.add(question.id);
      renderDashboard();
      updateProgressRing();
      navigateQuestion(1);
    });

    renderDashboard();
    updateProgressRing();
  </script>
</body>
</html>
